@page "/checkout"
@using System.ComponentModel.DataAnnotations
@inject IOrderService OrderService
@inject NavigationManager Nav
@inject ISnackbar Snackbar

<MudContainer MaxWidth="MaxWidth.Small">
    <MudText Typo="Typo.h3" Class="mb-4">Checkout</MudText>

    <MudForm @ref="form" @bind-IsValid="@success">
        <MudTextField T="string" Label="Full Name" Required="true" @bind-Value="model.Name"
            RequiredError="Name is required!" />

        <MudTextField T="string" Label="Email" Required="true" @bind-Value="model.Email"
            Validation="@(new EmailAddressAttribute() {ErrorMessage = "Invalid Email"})" />

        <MudTextField T="string" Label="Address" Required="true" @bind-Value="model.Address" />

        <MudTextField T="string" Label="Credit Card (Dummy)" Required="true" @bind-Value="model.CardNumber"
            Mask="@(new PatternMask("0000 0000 0000 0000"))" />

        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="mt-4" Disabled="@(!success)"
            OnClick="SubmitOrder">Complete Purchase</MudButton>
    </MudForm>
</MudContainer>

@code {
    bool success;
    MudForm form = default!;
    CheckoutModel model = new();

    private async Task SubmitOrder()
    {
        var result = await OrderService.CheckoutAsync();
        if (result)
        {
            Snackbar.Add("Order placed successfully!", Severity.Success);
            Nav.NavigateTo("/");
        }
        else
        {
            Snackbar.Add("Failed to place order. Ensure you are logged in.", Severity.Error);
        }
    }
}